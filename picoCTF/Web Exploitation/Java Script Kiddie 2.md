# **_Java Script Kiddie 2_**
## Description
The image link appears broken... twice as badly... `https://jupiter.challenges.picoctf.org/problem/42899` or `http://jupiter.challenges.picoctf.org:42899`
## Solution
Analyze the `js` script, notice that its similar to [Java Script Kiddie](https://github.com/Cyb3risFun/CTF-Writeups/blob/main/picoCTF/Java%20Script%20Kiddie.md), the only difference is that the keys are now 32 digits, and every two digits will be used as the shifted key, starting from index `0`, which means index `0,2,4,6...` is the shifted amount 

```js
var bytes = [];
$.get("bytes", function(resp) {
    bytes = Array.from(resp.split(" "), x => Number(x));
    });
function assemble_png(u_in){
	var LEN = 16;
	var key = "00000000000000000000000000000000";
	var shifter;
	if(u_in.length == key.length){
		key = u_in;
	}
	var result = [];
	for(var i = 0; i < LEN; i++){
		shifter = Number(key.slice((i*2),(i*2)+1));
		for(var j = 0; j < (bytes.length / LEN); j ++){
			result[(j * LEN) + i] = bytes[(((j + shifter) * LEN) % bytes.length) + i]
		}
	}
	while(result[result.length-1] == 0){
		result = result.slice(0,result.length-1);
	}
	document.getElementById("Area").src = "data:image/png;base64," + btoa(String.fromCharCode.apply(null, new Uint8Array(result)));
	return false;
}
```
Convert into a `python` script 
```py
# script.py

# Read original bytes 
f=open('bytes','rb')
# Convert into integer list
bytes_array=list(map(int,f.read().split()))
# Declare length
length=16
# Declare key
key="00000000000000000000000000000000"
# Create result list filled with 0
result=[0 for b in bytes_array]
# loop through keys
for i in range(length):
    # turn key into shift integer
    shifter=int(key[i*2])
    # loop through bytes list
    for j in range(round(len(bytes_array)/length)):
        # save shift results into result array
        result[(j*length)+i]=bytes_array[(j+shifter)*int(length)%len(bytes_array)+i]
# Remove ending 0 from result
while(result[:-1]==0):
    result=result[0:-1]
# print results in hex format
for b in range(len(result)):
    if(b%length==0):
        print()
    print("{:02x}".format(result[b]),end=" ")
```
Run the script to view the unshifted bytes
```console
❯ python3 script.py

fc 7f b9 fe 0d 72 67 49 ff 00 00 0d e7 48 db 10 
3b 60 4e d3 00 9f ef 0a 3e 00 00 00 42 c0 f2 47 
14 8c 01 09 76 35 44 72 f8 78 9c ed 49 51 a2 bb 
a0 7d 00 86 ad 49 3c 41 70 0e d0 a3 00 37 fc 47 
30 77 86 79 f4 1d fb 74 45 c0 e5 df 9b c9 df 00 
9d ba 92 00 86 9d af fb 00 e3 7c 0f 38 21 ff 52 
bf 50 0c 47 b5 00 aa 1f 01 38 ef bc 07 ce e8 6c 
89 00 f1 72 62 0a 77 11 54 fd 22 53 02 d1 82 e3 
00 00 5f 02 e3 00 00 50 61 24 91 48 f3 39 44 23 
a4 0c 07 7f b7 49 1a 78 71 ef fc f7 11 62 5f 3a 
30 d5 08 a3 21 03 01 ab 42 0d ec 43 92 71 8a fe 
cd c0 91 db 9c 00 44 d0 0e 02 f6 38 f8 4f d8 ef 
cb 0a 88 93 40 7a 79 e7 06 51 8e b5 ed f9 49 88 
a5 f3 39 f1 7d fc 05 14 90 14 28 13 ff 92 59 33 
bc 4c f4 da 7f 6b 91 44 d9 ca 29 03 c7 95 3b 2a 
88 f6 7b b6 f2 fc fa 48 3d 7f 10 af 00 79 87 49 
80 24 70 58 08 21 00 7b fa 01 f6 38 32 58 90 f0 
53 ba 1b 88 d0 ef a3 ee 01 9c cd dd f9 bf 11 f0 
7c 63 00 13 9b 00 f3 ac e4 72 30 d7 ff 1c fe 33 
79 7a 1c 5a df 19 19 2b cb f3 f6 2d 07 73 fc 48 
91 6c db 9c c8 15 2c d2 9c 65 ac a1 a6 7b e7 52 
ff 00 ff d3 16 28 09 ad db 3a 9b bb 90 d4 f5 dd 
19 a9 9d 2b 2e f9 3f ac d0 cc c9 5a 4b 85 91 f5 
ea 32 8f 20 b7 54 bf fc 90 ac a1 a0 5b 29 27 80 
8f c3 b2 97 7b 72 58 c5 5e 33 04 f1 6e 5c be 4d 
c7 fe 3f 23 28 6b f0 3e 65 82 98 8f 9b c7 1f a2 
fd 70 d6 76 82 fc 71 d3 5a f3 22 23 2a 5a 2c 70 
e9 57 9e f2 ed 63 13 a0 05 de 28 cb b2 0e ac c9 
eb 0a de df 80 bf 4b f1 25 87 d9 e3 45 63 05 4a 
c9 67 10 fb 4b f9 73 29 19 ab 22 d6 b9 fc 9a 5f 
68 44 f5 7f 9c 43 73 dd 15 e9 fb 4a fc fd d5 67 
ab 20 e9 81 fb e6 f5 ce d2 ad 9c f6 ba 6f c3 81 
07 f2 cf 6f 06 00 be 90 5b a3 e9 fa da f7 7e f2 
f0 6e 6c ff b0 74 9b 72 88 29 d3 65 fb a5 f9 b5 
33 ee b9 45 b5 93 97 d2 f9 9a 3e 69 55 7b 7f ed 
9b 5f fe ea fb 74 19 2b e6 5b 3b 38 30 df 92 23 
bf df 3d 93 2a e6 6f 5a 83 5f f5 ae 39 f8 f9 fc 
8c 9b 5f b1 9e a3 19 92 95 39 5d 07 72 10 fc 36 
bf 9f b7 d2 79 ef c0 05 c6 1e 1f 5b 67 81 db 45 
4e c9 1d 0c 96 c9 95 9d ad 3f d9 29 00 d7 af 69 
3f 77 7a cb c9 71 3a be 30 fc 55 b7 93 f8 fc f7 
ed cf 63 f2 e7 e5 39 79 d4 fe 0f 5b 7f 1e e3 f6 
cf fc de f0 00 fe ac fe 70 4e 44 ae bc 60 8d 8c
```
We know that a `png` file should begin with `89 50 4E 47 0D 0A 1A 0A 00 00 00 0D 49 48 44 52`, calculated the key 
>70601060007090105000000020008050

Modify the `python` script to save the output as a `png` file
```py
# script.py

# Read original bytes 
f=open('bytes','rb')
# Convert into integer list
bytes_array=list(map(int,f.read().split()))
# Declare length
length=16
# Declare key
key="70601060007090105000000020008050"
# Create result list filled with 0
result=[0 for b in bytes_array]
# loop through keys
for i in range(length):
    # turn key into shift integer
    shifter=int(key[i*2])
    # loop through bytes list
    for j in range(round(len(bytes_array)/length)):
        # save shift results into result array
        result[(j*length)+i]=bytes_array[(j+shifter)*int(length)%len(bytes_array)+i]
# Remove ending 0 from result
while(result[:-1]==0):
    result=result[0:-1]
f=open('flag.png','wb')
png=""
for i in range(len(result)):
    # convert to hex
    png+=("{:02x}".format(result[i]))
# Write bytes to png
b=bytearray.fromhex(png)
f.write(b)
f.close()
```
Read the `png` file with `zbarimg` since its a `qr code` image
```console
❯ zbarimg flag.png
Connection Error (Failed to connect to socket /run/dbus/system_bus_socket: No such file or directory)
Connection Null
QR-Code:picoCTF{227c2d3465a6a4bcc8a1bc599e34f074}
scanned 1 barcode symbols from 1 images in 0.03 seconds
```
